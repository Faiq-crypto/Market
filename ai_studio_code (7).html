<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BasedMarket | Pro</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Space Grotesk', 'sans-serif'] },
                    colors: {
                        bg: '#020202',
                        card: '#0A0A0A',
                        primary: '#00FF94',
                        bear: '#FF2E2E',
                        bull: '#00D95F',
                    },
                    animation: { 'marquee': 'marquee 25s linear infinite' },
                    keyframes: { marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020202; color: white; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(15, 15, 15, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.08); }
        .card-gradient { background: linear-gradient(180deg, #0F0F0F 0%, #050505 100%); border: 1px solid #1A1A1A; }
        .nav-active { color: #00FF94; text-shadow: 0 0 10px rgba(0,255,148,0.3); }
        .nav-inactive { color: #555; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Chart Overlay to prevent clicking */
        .chart-wrapper { position: relative; height: 180px; width: 100%; border-radius: 12px; overflow: hidden; border: 1px solid #222; margin-bottom: 16px; }
        .chart-overlay { position: absolute; inset: 0; z-index: 50; cursor: default; }
        
        .live-indicator { display: inline-block; width: 6px; height: 6px; background-color: #00FF94; border-radius: 50%; box-shadow: 0 0 8px #00FF94; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* Button Boxes */
        .bet-box {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 12px; border-radius: 12px; border: 1px solid #222; background: #111;
            transition: all 0.2s; cursor: pointer; position: relative; overflow: hidden;
        }
        .bet-box:active { transform: scale(0.96); }
        
        /* Joined State styles */
        .joined-bear { background: #991b1b !important; border-color: #FF2E2E !important; color: white !important; pointer-events: none; }
        .joined-neutral { background: #4b5563 !important; border-color: #9ca3af !important; color: white !important; pointer-events: none; }
        .joined-bull { background: #14532d !important; border-color: #00D95F !important; color: white !important; pointer-events: none; }

    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- TOP TICKER -->
    <div class="h-8 bg-[#051a10] border-b border-green-900/20 flex items-center overflow-hidden whitespace-nowrap relative z-10">
        <div class="animate-marquee text-[10px] font-mono text-green-400 flex gap-8 uppercase tracking-widest">
            <span>★ LIVE VOL: $5,502,120</span>
            <span>★ 24H PAYOUTS: $892,040</span>
            <span>★ BTC #1401: BEAR WON</span>
            <span>★ ETH #1401: BEAR WON</span>
            <span>★ SOL/USDC POOL OPENING SOON</span>
        </div>
    </div>

    <!-- HEADER -->
    <header class="px-5 py-4 flex justify-between items-center z-10 bg-[#020202] border-b border-[#151515]">
        <div class="flex items-center gap-2.5">
            <div class="w-8 h-8 bg-primary/10 border border-primary/20 rounded-lg flex items-center justify-center">
                <i class="fa-solid fa-chart-simple text-primary text-sm"></i>
            </div>
            <span class="font-display font-bold text-lg tracking-tight">BASED<span class="text-primary">MARKET</span></span>
        </div>
        <button onclick="connectWallet()" id="walletBtn" class="bg-[#111] border border-[#333] text-[10px] font-bold py-2 px-4 rounded-full hover:border-primary hover:text-primary transition-all flex items-center gap-2 uppercase tracking-wide">
            <i class="fa-solid fa-wallet"></i> <span id="walletText">Connect</span>
        </button>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto no-scrollbar pb-28 bg-[#020202]" id="mainContainer">
        
        <!-- HOME VIEW -->
        <div id="view-home" class="px-4 pt-4">
            <!-- Tabs -->
            <div class="flex p-1 bg-[#0F0F0F] rounded-xl mb-6 sticky top-0 z-20 border border-[#222] shadow-xl">
                <button onclick="switchHomeTab('live')" id="tab-live" class="flex-1 py-2.5 rounded-lg text-[10px] tracking-widest font-bold bg-primary text-black transition-all">LIVE</button>
                <button onclick="switchHomeTab('upcoming')" id="tab-upcoming" class="flex-1 py-2.5 rounded-lg text-[10px] tracking-widest font-medium text-gray-500 hover:text-white transition-all">UPCOMING</button>
                <button onclick="switchHomeTab('ended')" id="tab-ended" class="flex-1 py-2.5 rounded-lg text-[10px] tracking-widest font-medium text-gray-500 hover:text-white transition-all">ENDED</button>
            </div>

            <!-- SECTION: LIVE -->
            <div id="section-live" class="space-y-6">
                
                <!-- BTC CARD -->
                <div class="card-gradient rounded-3xl p-1">
                    <div class="bg-[#080808] rounded-[20px] p-5">
                        <!-- Live Header -->
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-[#F7931A] flex items-center justify-center text-white text-lg shadow-lg shadow-orange-500/10"><i class="fa-brands fa-bitcoin"></i></div>
                                <div>
                                    <h3 class="font-bold text-sm text-white">BTC / USDT</h3>
                                    <p class="text-xl font-mono font-bold text-white mt-0.5 price-btc">Loading...</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-[10px] font-mono bg-[#111] text-gray-400 border border-[#222] px-2 py-1 rounded uppercase flex items-center gap-2">
                                    <span class="live-indicator"></span> Live
                                </span>
                            </div>
                        </div>

                        <!-- CHART (Non-Interactive) -->
                        <div class="chart-wrapper">
                            <div class="chart-overlay"></div> 
                            <div class="tradingview-widget-container" style="height:100%;width:100%">
                                <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                                {
                                "symbol": "BINANCE:BTCUSDT",
                                "width": "100%",
                                "height": "100%",
                                "locale": "en",
                                "dateRange": "1D",
                                "colorTheme": "dark",
                                "isTransparent": true,
                                "autosize": true,
                                "largeChartUrl": "",
                                "chartOnly": true,
                                "noTimeScale": true
                                }
                                </script>
                            </div>
                        </div>

                        <!-- Betting Boxes -->
                        <div class="grid grid-cols-3 gap-3">
                            <!-- Bear -->
                            <button id="btn-BTC-BEAR" onclick="openBetModal('BTC', 'BEAR', '85k-89k', 3.44)" class="bet-box hover:border-red-500 group">
                                <span class="text-bear font-bold text-sm mb-1 group-hover:text-red-400">BEAR</span>
                                <span class="text-[9px] text-gray-500">85k-89k</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-red-900/30 px-2 py-1 rounded border border-red-900/50">$3.44</span>
                            </button>
                            
                            <!-- Neutral -->
                            <button id="btn-BTC-NEUTRAL" onclick="openBetModal('BTC', 'NEUTRAL', '90k-93k', 4.89)" class="bet-box hover:border-white group">
                                <span class="text-gray-300 font-bold text-sm mb-1 group-hover:text-white">NEUTRAL</span>
                                <span class="text-[9px] text-gray-500">90k-93k</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-gray-800 px-2 py-1 rounded border border-gray-600">$4.89</span>
                            </button>

                            <!-- Bull -->
                            <button id="btn-BTC-BULL" onclick="openBetModal('BTC', 'BULL', '>95k', 3.44)" class="bet-box hover:border-bull group">
                                <span class="text-bull font-bold text-sm mb-1 group-hover:text-green-400">BULL</span>
                                <span class="text-[9px] text-gray-500">>95k</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-green-900/30 px-2 py-1 rounded border border-green-900/50">$3.44</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ETH CARD -->
                <div class="card-gradient rounded-3xl p-1">
                    <div class="bg-[#080808] rounded-[20px] p-5">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-[#627EEA] flex items-center justify-center text-white text-lg shadow-lg shadow-indigo-500/10"><i class="fa-brands fa-ethereum"></i></div>
                                <div>
                                    <h3 class="font-bold text-sm text-white">ETH / USDT</h3>
                                    <p class="text-xl font-mono font-bold text-white mt-0.5 price-eth">Loading...</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-[10px] font-mono bg-[#111] text-gray-400 border border-[#222] px-2 py-1 rounded uppercase flex items-center gap-2">
                                    <span class="live-indicator"></span> Live
                                </span>
                            </div>
                        </div>

                        <!-- CHART -->
                        <div class="chart-wrapper">
                            <div class="chart-overlay"></div>
                            <div class="tradingview-widget-container" style="height:100%;width:100%">
                                <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                                {
                                "symbol": "BINANCE:ETHUSDT",
                                "width": "100%",
                                "height": "100%",
                                "locale": "en",
                                "dateRange": "1D",
                                "colorTheme": "dark",
                                "isTransparent": true,
                                "autosize": true,
                                "largeChartUrl": "",
                                "chartOnly": true,
                                "noTimeScale": true
                                }
                                </script>
                            </div>
                        </div>

                        <!-- Betting Boxes -->
                        <div class="grid grid-cols-3 gap-3">
                            <!-- Bear -->
                            <button id="btn-ETH-BEAR" onclick="openBetModal('ETH', 'BEAR', '2800-3000', 3.44)" class="bet-box hover:border-red-500 group">
                                <span class="text-bear font-bold text-sm mb-1 group-hover:text-red-400">BEAR</span>
                                <span class="text-[9px] text-gray-500">Low</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-red-900/30 px-2 py-1 rounded border border-red-900/50">$3.44</span>
                            </button>
                            
                            <!-- Neutral -->
                            <button id="btn-ETH-NEUTRAL" onclick="openBetModal('ETH', 'NEUTRAL', '3100-3300', 4.89)" class="bet-box hover:border-white group">
                                <span class="text-gray-300 font-bold text-sm mb-1 group-hover:text-white">NEUTRAL</span>
                                <span class="text-[9px] text-gray-500">Mid</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-gray-800 px-2 py-1 rounded border border-gray-600">$4.89</span>
                            </button>

                            <!-- Bull -->
                            <button id="btn-ETH-BULL" onclick="openBetModal('ETH', 'BULL', '>3400', 3.44)" class="bet-box hover:border-bull group">
                                <span class="text-bull font-bold text-sm mb-1 group-hover:text-green-400">BULL</span>
                                <span class="text-[9px] text-gray-500">High</span>
                                <span class="text-[10px] font-bold text-white mt-2 bg-green-900/30 px-2 py-1 rounded border border-green-900/50">$3.44</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UPCOMING (Placeholder) -->
            <div id="section-upcoming" class="space-y-4 hidden">
                <div class="text-center text-[10px] text-gray-500 mb-4 uppercase tracking-widest">Tomorrow's Markets</div>
                <div class="bg-[#0A0A0A] rounded-2xl p-6 border border-[#222] relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-[2px] z-10">
                        <div class="bg-black border border-[#333] px-4 py-2 rounded-full flex items-center gap-2 text-xs text-gray-300">
                            <i class="fa-solid fa-lock text-primary"></i> <span>Opens in 24h</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 opacity-30">
                        <div class="w-12 h-12 rounded-full bg-purple-500"></div>
                        <h3 class="text-xl font-bold">SOL / USDT</h3>
                    </div>
                </div>
            </div>

            <!-- ENDED (Placeholder) -->
            <div id="section-ended" class="space-y-4 hidden">
                <div class="text-center text-[10px] text-gray-500 mb-4 uppercase tracking-widest">Yesterday's Results</div>
                <div class="bg-[#0A0A0A] rounded-2xl p-4 border border-[#222]">
                    <div class="flex justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <i class="fa-brands fa-bitcoin text-[#F7931A]"></i> <span class="font-bold text-sm">BTC / USDT</span>
                        </div>
                        <span class="text-[10px] text-gray-500">Round #1401</span>
                    </div>
                    <div class="bg-red-900/10 border border-red-900/30 p-3 rounded-xl flex justify-between items-center">
                        <div><span class="text-xs text-red-500 font-bold block">BEAR WON</span></div>
                        <div class="text-right"><span class="text-sm font-mono font-bold text-white block">1.88x</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- REWARDS VIEW -->
        <div id="view-rewards" class="px-4 pt-4 hidden">
            <div class="bg-gradient-to-br from-green-900/20 to-black border border-green-500/20 rounded-3xl p-8 text-center mb-6 relative overflow-hidden">
                <h2 class="text-3xl font-display font-bold mb-2">Refer & Earn</h2>
                <p class="text-gray-400 text-sm">Get <span class="text-white font-bold">$1.00</span> for every friend.</p>
                <div class="mt-6 bg-black/60 backdrop-blur-sm p-2 rounded-xl border border-white/10 flex items-center justify-between pl-4">
                    <span class="text-[10px] text-gray-500 font-mono truncate max-w-[150px]" id="refLinkBox">Connect Wallet</span>
                    <button onclick="copyRef()" class="bg-primary hover:bg-green-400 text-black text-xs font-bold px-3 py-2 rounded-lg transition">COPY</button>
                </div>
            </div>
            <div class="bg-[#0A0A0A] border border-[#222] rounded-2xl p-6">
                <div class="relative w-full h-2 bg-[#111] rounded-full mb-8 mt-2">
                    <div class="absolute top-0 left-0 h-full bg-primary rounded-full w-[10%] shadow-[0_0_10px_#00FF94]"></div>
                    <div class="absolute top-4 left-[10%] -translate-x-1/2 text-[9px] text-center text-white font-bold">1 Ref<br>$1</div>
                </div>
            </div>
        </div>

        <!-- PROFILE VIEW -->
        <div id="view-profile" class="px-4 pt-4 hidden">
            <div class="bg-[#0A0A0A] border border-[#222] rounded-3xl p-6 mb-6 text-center relative">
                <div class="w-20 h-20 bg-[#111] rounded-full mx-auto mb-4 flex items-center justify-center border border-[#222]">
                    <i class="fa-solid fa-user-astronaut text-3xl text-gray-600"></i>
                </div>
                <h2 class="text-sm font-bold font-mono text-gray-300" id="profileAddress">0x...</h2>
                <div class="mt-6 bg-black p-4 rounded-xl border border-[#222]">
                    <div class="text-[9px] text-gray-500 uppercase tracking-wider mb-1">Wallet Balance</div>
                    <div class="text-primary font-mono font-bold text-xl" id="profileBalance">--</div>
                </div>
            </div>
            <div id="historyList" class="text-center text-gray-700 text-xs italic pt-4">No active bets.</div>
        </div>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="fixed bottom-0 w-full glass h-[85px] pb-5 px-8 flex justify-between items-center z-50">
        <button onclick="switchBottomTab('home')" id="nav-home" class="flex flex-col items-center gap-1 nav-active transition-all">
            <i class="fa-solid fa-house text-xl"></i>
        </button>
        <button onclick="switchBottomTab('rewards')" id="nav-rewards" class="flex flex-col items-center gap-1 nav-inactive transition-all relative">
            <i class="fa-solid fa-gift text-xl"></i>
            <div class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse border border-black"></div>
        </button>
        <button onclick="switchBottomTab('profile')" id="nav-profile" class="flex flex-col items-center gap-1 nav-inactive transition-all">
            <i class="fa-solid fa-user text-xl"></i>
        </button>
    </nav>

    <!-- BETTING MODAL -->
    <div id="betModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-[#0A0A0A] w-full max-w-sm rounded-[30px] p-6 border border-[#222] relative">
            <button onclick="closeModal()" class="absolute top-5 right-6 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-lg font-bold text-white text-center mb-6">Confirm Entry</h3>
            
            <div class="space-y-3 mb-6">
                <div class="flex justify-between items-center p-4 bg-[#050505] rounded-2xl border border-[#1A1A1A]">
                    <span class="text-gray-400 text-xs font-medium">Prediction</span>
                    <span class="font-bold text-sm" id="modalSide">--</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-[#050505] rounded-2xl border border-[#1A1A1A]">
                    <span class="text-gray-400 text-xs font-medium">Total Entry</span>
                    <span class="font-bold text-white font-mono text-sm">$2.00 USDT</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-green-900/10 rounded-2xl border border-green-900/30">
                    <span class="text-green-400 text-xs font-medium">Est. Payout (If Won)</span>
                    <span class="font-bold text-green-400 font-mono text-sm" id="modalPayout">--</span>
                </div>
            </div>
            
            <button onclick="submitBet()" id="confirmBtn" class="w-full bg-primary hover:bg-[#00CC76] text-black font-bold py-4 rounded-2xl text-sm uppercase tracking-widest shadow-[0_0_20px_rgba(0,255,148,0.2)] transition-all">
                Pay $2.00
            </button>
        </div>
    </div>

    <script>
        // ============================================================
        // CONFIGURATION
        const GOOGLE_SCRIPT_URL = "PASTE_YOUR_WEB_APP_URL_HERE"; 
        const ADMIN_WALLET = "0x91A6d3FFFe7491DeB69130523B48ed2f5336FE6b"; // Specified Wallet
        const TOKEN_ADDRESS = "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"; // Polygon USDC
        // ============================================================

        let userAddress = null;
        let provider, signer;
        let currentBet = {};

        // 1. LIVE PRICE FEED
        async function fetchPrices() {
            try {
                const btcRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                const btcData = await btcRes.json();
                document.querySelector('.price-btc').innerText = '$' + parseFloat(btcData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                const ethRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
                const ethData = await ethRes.json();
                document.querySelector('.price-eth').innerText = '$' + parseFloat(ethData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            } catch (e) { console.log("Price fetch error", e); }
        }
        setInterval(fetchPrices, 3000);
        fetchPrices();

        // 2. NAVIGATION LOGIC
        function switchBottomTab(tab) {
            ['home', 'rewards', 'profile'].forEach(t => {
                document.getElementById(`view-${t}`).style.display = t === tab ? 'block' : 'none';
                document.getElementById(`nav-${t}`).className = t === tab ? "flex flex-col items-center gap-1 nav-active" : "flex flex-col items-center gap-1 nav-inactive";
            });
        }
        function switchHomeTab(tab) {
            ['live', 'upcoming', 'ended'].forEach(t => {
                document.getElementById(`section-${t}`).style.display = t === tab ? 'block' : 'none';
                const btn = document.getElementById(`tab-${t}`);
                btn.className = t === tab ? "flex-1 py-2.5 rounded-lg text-[10px] tracking-widest font-bold bg-primary text-black transition-all" : "flex-1 py-2.5 rounded-lg text-[10px] tracking-widest font-medium text-gray-500 hover:text-white transition-all";
            });
        }

        // 3. BETTING LOGIC
        function openBetModal(asset, side, range, payout) {
            if(!userAddress) return alert("Please Connect Wallet First");
            
            currentBet = { asset, side, range, payout };
            
            document.getElementById('modalSide').innerText = `${asset} ${side}`;
            document.getElementById('modalSide').className = side === 'BEAR' ? "font-bold text-sm text-bear" : (side === 'BULL' ? "font-bold text-sm text-bull" : "font-bold text-sm text-white");
            document.getElementById('modalPayout').innerText = `$${payout}`;
            
            document.getElementById('betModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('betModal').style.display = 'none'; }

        async function connectWallet() {
            if (!window.ethereum) return alert("No Crypto Wallet Found");
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            userAddress = await signer.getAddress();
            
            document.getElementById('walletText').innerText = userAddress.slice(0,4) + '..';
            document.getElementById('profileAddress').innerText = userAddress;
            document.getElementById('refLinkBox').innerText = `${window.location.origin}?ref=${userAddress}`;
            
            // Get Balance
            try {
                const contract = new ethers.Contract(TOKEN_ADDRESS, ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)"], provider);
                const bal = await contract.balanceOf(userAddress);
                const dec = await contract.decimals();
                document.getElementById('profileBalance').innerText = parseFloat(ethers.utils.formatUnits(bal, dec)).toFixed(2) + " USDT";
            } catch(e) { console.log("Error fetching balance"); }
        }

        async function submitBet() {
            const btn = document.getElementById('confirmBtn');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...';
            
            try {
                const contract = new ethers.Contract(TOKEN_ADDRESS, ["function transfer(address, uint256) returns (bool)", "function decimals() view returns (uint8)"], signer);
                const dec = await contract.decimals();
                const amount = ethers.utils.parseUnits("2.0", dec);

                // Trigger Transaction
                const tx = await contract.transfer(ADMIN_WALLET, amount);
                closeModal();
                alert("Transaction Sent! Updating UI...");
                await tx.wait();

                // Send to DB
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: "POST", mode: "no-cors",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        user: userAddress,
                        asset: currentBet.asset,
                        prediction: currentBet.side,
                        amount: "2.0",
                        txHash: tx.hash,
                        referrer: new URLSearchParams(window.location.search).get('ref') || 'None'
                    })
                });
                
                // === UPDATE UI TO "JOINED" ===
                const btnId = `btn-${currentBet.asset}-${currentBet.side}`;
                const buttonEl = document.getElementById(btnId);
                
                // Create distinct look based on side
                let joinedClass = "";
                if(currentBet.side === 'BEAR') joinedClass = "joined-bear";
                else if(currentBet.side === 'NEUTRAL') joinedClass = "joined-neutral";
                else if(currentBet.side === 'BULL') joinedClass = "joined-bull";
                
                buttonEl.className = `bet-box ${joinedClass}`;
                buttonEl.innerHTML = `
                    <span class="font-bold text-sm mb-1">JOINED</span>
                    <span class="text-[9px] opacity-80">${currentBet.range}</span>
                    <span class="text-[10px] font-bold mt-2 bg-black/20 px-2 py-1 rounded"><i class="fa-solid fa-check"></i></span>
                `;
                
                // Add to History
                document.getElementById('historyList').innerHTML = `<div class="bg-[#111] p-3 rounded-xl border border-[#222] flex justify-between mb-2"><span class="text-white font-bold">${currentBet.asset} ${currentBet.side}</span><span class="text-green-500 text-xs">Active</span></div>` + document.getElementById('historyList').innerHTML;
                
                btn.innerText = "Pay $2.00";
                alert("Bet Placed Successfully!");

            } catch(e) {
                console.error(e);
                btn.innerText = "Pay $2.00";
                alert("Transaction Failed");
                closeModal();
            }
        }

        function copyRef() {
            if(!userAddress) return alert("Connect wallet");
            navigator.clipboard.writeText(document.getElementById('refLinkBox').innerText);
            alert("Referral Link Copied");
        }
    </script>
</body>
</html>